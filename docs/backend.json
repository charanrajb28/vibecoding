{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the CodeSail platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "User's chosen username."
        },
        "fullName": {
          "type": "string",
          "description": "User's full name."
        },
        "bio": {
          "type": "string",
          "description": "A short bio or description about the user."
        },
        "websiteUrl": {
          "type": "string",
          "description": "URL to the user's personal website or portfolio.",
          "format": "uri"
        },
        "githubUsername": {
          "type": "string",
          "description": "The user's GitHub username."
        },
        "twitterHandle": {
          "type": "string",
          "description": "The user's Twitter (X) handle."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the user account was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "username",
        "fullName",
        "createdAt"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a coding project within CodeSail.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Project)"
        },
        "name": {
          "type": "string",
          "description": "Name of the project."
        },
        "description": {
          "type": "string",
          "description": "Description of the project."
        },
        "template": {
          "type": "string",
          "description": "The template used to create the project (e.g., 'Next.js', 'React')."
        },
        "gitRepoUrl": {
          "type": "string",
          "description": "URL of the Git repository (if imported from Git).",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the project was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the project was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "createdAt"
      ]
    },
    "Template": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Template",
      "type": "object",
      "description": "Represents a project template.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the template."
        },
        "name": {
          "type": "string",
          "description": "Name of the template (e.g., 'Next.js', 'React')."
        },
        "description": {
          "type": "string",
          "description": "Description of the template."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the template's image.",
          "format": "uri"
        },
        "files": {
          "type": "array",
          "description": "Array of file objects contained in the template.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Only the authenticated user can read/write their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores projects owned by a user. Only the authenticated user (owner) can read/write these projects.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching the Firebase Auth UID."
            },
            {
              "name": "projectId",
              "description": "The unique ID of the project."
            }
          ]
        }
      },
      {
        "path": "/templates/{templateId}",
        "definition": {
          "entityName": "Template",
          "schema": {
            "$ref": "#/backend/entities/Template"
          },
          "description": "Stores project templates.  These are globally accessible and read-only for all users.",
          "params": [
            {
              "name": "templateId",
              "description": "The unique ID of the template."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support CodeSail's core features, including user authentication, project management, template selection, and Git integration. The structure prioritizes authorization independence and clear security rules.  It leverages path-based ownership for user-related data (projects) and structural segregation to maintain homogeneous security postures within collections.  Authorization Independence is achieved via path-based ownership and is directly tied to the authenticated user's ID (`request.auth.uid`).  QAPs are supported through structural segregation and predictable schema, where `list` operations can be securely performed based on path ownership."
  }
}
